<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R2R - Login</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap');
        body { font-family: 'Kanit', sans-serif; margin: 0; background-color: #f0f4f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .auth-container { background-color: #ffffff; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); width: 100%; max-width: 400px; box-sizing: border-box; text-align: center; }
        .auth-header h1 { color: #1a237e; font-size: 2.2rem; margin-bottom: 10px; }
        .auth-header p { color: #546e7a; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; font-weight: bold; color: #37474f; margin-bottom: 8px; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #cfd8dc; border-radius: 10px; box-sizing: border-box; font-family: 'Kanit', sans-serif; font-size: 1rem; }
        .password-group { position: relative; }
        .password-group .toggle-password { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); cursor: pointer; color: #78909c; font-size: 1.2rem; }
        .auth-button { background: linear-gradient(90deg, #3f51b5, #1a237e); color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .switch-auth { margin-top: 20px; color: #546e7a; }
        .switch-auth a { color: #3f51b5; font-weight: bold; text-decoration: none; cursor: pointer; }
        .hidden { display: none; }
        .pin-input { font-size: 1.8rem; text-align: center; letter-spacing: 1rem; } /* Style for PIN input */
    </style>
</head>
<body>
    <div class="auth-container">
        <div id="password-login-view">
            <div class="auth-header"><h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö! üëã</h1><p>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p></div>
            <form id="password-form">
                <div class="form-group"><label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input type="email" id="email" placeholder="you@email.com" required></div>
                <div class="form-group"><label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><div class="password-group"><input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required><span class="toggle-password">üëÅÔ∏è</span></div></div>
                <button type="submit" class="auth-button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
            <div class="switch-auth"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="register.html">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a></p></div>
        </div>

        <div id="pin-login-view" class="hidden">
             <div class="auth-header"><h1>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!</h1><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p></div>
            <form id="pin-form">
                <div class="form-group"><input type="password" class="pin-input" id="pin-input-login" maxlength="4" pattern="[0-9]*" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required></div>
                <button type="submit" class="auth-button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ PIN</button>
            </form>
            <div class="switch-auth"><a id="show-password-login">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ó‡∏ô</a></div>
        </div>
        
        <div id="pin-setup-view" class="hidden">
            <div class="auth-header">
                <h1>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN</h1>
                <p>‡∏™‡∏£‡πâ‡∏≤‡∏á PIN 4 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</p>
            </div>
            <form id="pin-setup-form">
                <div class="form-group">
                    <label for="new-pin">‡∏™‡∏£‡πâ‡∏≤‡∏á PIN ‡πÉ‡∏´‡∏°‡πà</label>
                    <input type="password" class="pin-input" id="new-pin" maxlength="4" pattern="[0-9]*" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div class="form-group">
                    <label for="confirm-pin">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô PIN</label>
                    <input type="password" class="pin-input" id="confirm-pin" maxlength="4" pattern="[0-9]*" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="auth-button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PIN</button>
            </form>
        </div>

        <div class="switch-auth" style="margin-top: 30px;">
            <a id="reset-pin-setup" style="color: #ef5350;">(‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö) ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ PIN</a>
        </div>
    </div>

    <script>
        // --- Variable Declarations ---
        const passwordView = document.getElementById('password-login-view');
        const pinView = document.getElementById('pin-login-view');
        const pinSetupView = document.getElementById('pin-setup-view'); // View ‡πÉ‡∏´‡∏°‡πà
        const passwordForm = document.getElementById('password-form');
        const pinForm = document.getElementById('pin-form');
        const pinSetupForm = document.getElementById('pin-setup-form'); // Form ‡πÉ‡∏´‡∏°‡πà
        const showPasswordLink = document.getElementById('show-password-login');
        const resetPinLink = document.getElementById('reset-pin-setup');
        const togglePassword = document.querySelector('.toggle-password');
        const passwordInput = document.getElementById('password');

        // --- Main Logic on Page Load ---
        function checkPinStatus() {
            if (localStorage.getItem('run2reward_hasPin') === 'true') {
                passwordView.classList.add('hidden');
                pinSetupView.classList.add('hidden');
                pinView.classList.remove('hidden');
            } else {
                pinView.classList.add('hidden');
                pinSetupView.classList.add('hidden');
                passwordView.classList.remove('hidden');
            }
        }
        checkPinStatus(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö

        // --- Event Listeners ---

        // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£ submit ‡∏ü‡∏≠‡∏£‡πå‡∏° "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
        passwordForm.addEventListener('submit', function(event) {
            event.preventDefault();
            Swal.fire({
                icon: 'success',
                title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN 4 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                showDenyButton: true,
                confirmButtonText: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN',
                denyButtonText: `‡πÑ‡∏°‡πà, ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì`,
            }).then((result) => {
                if (result.isConfirmed) {
                    // ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏Å‡∏•‡∏á ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô View ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á View ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN
                    passwordView.classList.add('hidden');
                    pinView.classList.add('hidden');
                    pinSetupView.classList.remove('hidden');
                } else if (result.isDenied) {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏Å‡πá‡πÅ‡∏Ñ‡πà redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
                    // window.location.href = 'index.html';
                }
            });
        });

        // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£ submit ‡∏ü‡∏≠‡∏£‡πå‡∏° "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN"
        pinSetupForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const newPin = document.getElementById('new-pin').value;
            const confirmPin = document.getElementById('confirm-pin').value;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ PIN ‡∏°‡∏µ 4 ‡∏´‡∏•‡∏±‡∏Å
            if (newPin.length !== 4) {
                 Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å PIN ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 4 ‡∏´‡∏•‡∏±‡∏Å', 'error');
                 return;
            }
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ PIN ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (newPin !== confirmPin) {
                Swal.fire('PIN ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å PIN ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô PIN ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô', 'error');
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            localStorage.setItem('run2reward_hasPin', 'true');
            // ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ PIN ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö ‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á
            localStorage.setItem('run2reward_userPin', newPin); 

            Swal.fire('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢', 'success');
            // ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
            // window.location.href = 'index.html';
        });
        
        // 3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£ submit ‡∏ü‡∏≠‡∏£‡πå‡∏° "PIN Login"
        pinForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const enteredPin = document.getElementById('pin-input-login').value;
            const savedPin = localStorage.getItem('run2reward_userPin');

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö PIN (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ)
            if (enteredPin === savedPin) {
                 Swal.fire({ icon: 'success', title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', showConfirmButton: false, timer: 1500 });
                 // redirect to index.html
            } else {
                 Swal.fire('PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        });

        // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ó‡∏ô"
        showPasswordLink.addEventListener('click', function() {
            pinView.classList.add('hidden');
            pinSetupView.classList.add('hidden');
            passwordView.classList.remove('hidden');
        });

        // 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        togglePassword.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        // 6. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ PIN" (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö)
        resetPinLink.addEventListener('click', function() {
            localStorage.removeItem('run2reward_hasPin');
            localStorage.removeItem('run2reward_userPin');
            alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PIN ‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö');
            window.location.reload();
        });
    </script>
</body>
</html>